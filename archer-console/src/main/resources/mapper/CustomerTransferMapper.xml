<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mr.archer.dao.CustomerTransferMapper">

  <!-- 通用查询映射结果 -->
  <resultMap id="BaseResultMap" type="com.mr.archer.entity.CustomerTransfer">
    <id column="id" property="id"/>
    <result column="righttype" property="righttype"/>
    <result column="customerid" property="customerid"/>
    <result column="userid" property="userid"/>
    <result column="applydate" property="applydate"/>
    <result column="confirmdate" property="confirmdate"/>
    <result column="refusedate" property="refusedate"/>
    <result column="status" property="status"/>
    <result column="createuser" property="createuser"/>
    <result column="createtime" property="createtime"/>
    <result column="createorg" property="createorg"/>
    <result column="updateuser" property="updateuser"/>
    <result column="updatetime" property="updatetime"/>
    <result column="updateorg" property="updateorg"/>
  </resultMap>

  <select id="selectListByCreateUser" resultType="com.mr.archer.entity.CustomerTransfer">
    select
    ct.*,
    ci.name as customername,
    ci.certtype as certtype,
    ci.certid as certid,
    su1.nick as username,
    so1.name as createorgname
    from customer_transfer ct
    left join customer_info ci on ct.customerid = ci.id
    left join sys_user su1 on ct.userid = su1.id
    left join sys_org so1 on ct.createorg = so1.id
    where ct.createuser = #{userid}
    <if test="customername != null and customername != ''">
      and ci.`name` like concat('%',#{customername},'%')
    </if>
  </select>

  <select id="selectListByUser" resultType="com.mr.archer.entity.CustomerTransfer">
    select
    ct.*,
    ci.name as customername,
    ci.certtype as certtype,
    ci.certid as certid,
    su1.nick as createusername,
    so1.name as createorgname
    from customer_transfer ct
    left join customer_info ci on ct.customerid = ci.id
    left join sys_user su1 on ct.createuser = su1.id
    left join sys_org so1 on ct.createorg = so1.id
    where ct.userid = #{userid}
    and ct.status = #{status}
    <if test="customername != null and customername != ''">
      and ci.`name` like concat('%',#{customername},'%')
    </if>
  </select>

  <update id="updateStatusById">
    update customer_transfer
    set status=#{status},updateuser=#{updateuser},updatetime=#{updatetime},updateorg=#{updateorg}
    <if test="status == '02'">
      ,confirmdate=#{updatetime}
    </if>
    <if test="status == '03'">
      ,refusedate=#{updatetime}
    </if>
    where id=#{id}
  </update>

</mapper>
